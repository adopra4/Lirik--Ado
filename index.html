<!DOCTYPE html>
<html lang="id" data-theme="dark" data-version="1.3.0">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="LyricFlow v1.3 - Ultimate Music Player with AI, P2P Sync, Voice Control & Advanced Analytics">
    <meta name="keywords" content="music player, lyrics, AI, P2P, offline, voice control, analytics">
    <meta name="author" content="LyricFlow Team">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>LyricFlow v1.3 - Ultimate Music Experience</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="assets/icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/icon-180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="assets/icons/icon-167.png">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/core.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/themes/dark.css" id="themeStylesheet">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="js/core.js" as="script">
    <link rel="preload" href="js/player.js" as="script">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16.png">
</head>
<body>
    <!-- ==================== APP CONTAINER ==================== -->
    <div id="app" class="app" data-state="loading">
        
        <!-- ==================== LOADING SCREEN ==================== -->
        <div id="loadingScreen" class="loading-screen" role="dialog" aria-label="Loading">
            <div class="loading-container">
                <div class="loading-brand">
                    <div class="loading-logo">
                        <div class="vinyl-spin">
                            <div class="vinyl-grooves"></div>
                            <div class="vinyl-label">LF</div>
                        </div>
                    </div>
                    <h1 class="loading-title">LyricFlow</h1>
                    <p class="loading-version">Version 1.3.0</p>
                </div>
                
                <div class="loading-progress-container">
                    <div class="loading-stage" id="loadingStage">Initializing core systems...</div>
                    <div class="loading-bar">
                        <div class="loading-progress" id="loadingProgress"></div>
                    </div>
                    <div class="loading-stats">
                        <span id="loadingPercent">0%</span>
                        <span id="loadingModules">0/15 modules</span>
                    </div>
                </div>
                
                <div class="loading-tips" id="loadingTips">
                    <p>üí° Tip: Press '?' anytime to see keyboard shortcuts</p>
                </div>
                
                <div class="loading-skip">
                    <button onclick="app.loading.skip()" class="btn-skip">Skip Intro</button>
                </div>
            </div>
            
            <div class="loading-background">
                <div class="blob blob-1"></div>
                <div class="blob blob-2"></div>
                <div class="blob blob-3"></div>
            </div>
        </div>

        <!-- ==================== OFFLINE BANNER ==================== -->
        <div id="offlineBanner" class="offline-banner hidden">
            <div class="offline-content">
                <span class="offline-icon">üì¥</span>
                <span class="offline-text">You're offline. Some features may be limited.</span>
                <button onclick="app.offline.sync()" class="btn-sync-now">Sync Now</button>
            </div>
            <button onclick="app.ui.hideOfflineBanner()" class="btn-close-offline">√ó</button>
        </div>

        <!-- ==================== UPDATE BANNER ==================== -->
        <div id="updateBanner" class="update-banner hidden">
            <div class="update-content">
                <span class="update-icon">üéâ</span>
                <span class="update-text">New version available!</span>
                <button onclick="app.update.apply()" class="btn-update">Update Now</button>
            </div>
        </div>

        <!-- ==================== SIDEBAR ==================== -->
        <aside id="sidebar" class="sidebar" role="navigation" aria-label="Main Navigation">
            
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="brand">
                    <div class="brand-icon">
                        <div class="mini-vinyl">
                            <div class="mini-vinyl-grooves"></div>
                        </div>
                    </div>
                    <div class="brand-text">
                        <h1 class="brand-name">LyricFlow</h1>
                        <span class="brand-version">v1.3.0</span>
                    </div>
                </div>
                <button class="btn-collapse" onclick="app.ui.toggleSidebar()" aria-label="Collapse sidebar">
                    <span class="collapse-icon">‚óÄ</span>
                </button>
            </div>

            <!-- User Profile Card -->
            <div class="user-card" id="userCard">
                <div class="user-avatar-container">
                    <img src="assets/images/default-avatar.png" alt="User" class="user-avatar" id="userAvatar">
                    <div class="user-status online" id="userStatus"></div>
                </div>
                <div class="user-info">
                    <span class="user-name" id="userName">Guest User</span>
                    <span class="user-role" id="userRole">Free Plan</span>
                </div>
                <button class="btn-user-menu" onclick="app.user.openMenu()">‚ãÆ</button>
            </div>

            <!-- Main Navigation -->
            <nav class="main-nav">
                <div class="nav-section">
                    <span class="nav-section-title">Discover</span>
                    <ul class="nav-list">
                        <li class="nav-item active" data-view="home" data-tab="main">
                            <a href="#home" class="nav-link">
                                <span class="nav-icon">üè†</span>
                                <span class="nav-text">Home</span>
                                <span class="nav-badge new" id="homeBadge">NEW</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="discover" data-tab="main">
                            <a href="#discover" class="nav-link">
                                <span class="nav-icon">‚ú®</span>
                                <span class="nav-text">Discover</span>
                                <span class="nav-badge ai">AI</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="live" data-tab="main">
                            <a href="#live" class="nav-link">
                                <span class="nav-icon">
                                    <span class="live-dot"></span>
                                    üî¥
                                </span>
                                <span class="nav-text">Live</span>
                                <span class="nav-badge" id="liveBadge">OFF</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">Library</span>
                    <ul class="nav-list">
                        <li class="nav-item" data-view="library" data-tab="main">
                            <a href="#library" class="nav-link">
                                <span class="nav-icon">üìö</span>
                                <span class="nav-text">Library</span>
                                <span class="nav-count" id="libraryCount">0</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="playlists" data-tab="main">
                            <a href="#playlists" class="nav-link">
                                <span class="nav-icon">üìë</span>
                                <span class="nav-text">Playlists</span>
                                <span class="nav-count" id="playlistCount">0</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="favorites" data-tab="main">
                            <a href="#favorites" class="nav-link">
                                <span class="nav-icon">‚ù§Ô∏è</span>
                                <span class="nav-text">Favorites</span>
                                <span class="nav-count" id="favoritesCount">0</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="history" data-tab="main">
                            <a href="#history" class="nav-link">
                                <span class="nav-icon">üïê</span>
                                <span class="nav-text">History</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="offline" data-tab="main">
                            <a href="#offline" class="nav-link">
                                <span class="nav-icon">üì≤</span>
                                <span class="nav-text">Offline</span>
                                <span class="nav-count" id="offlineCount">0</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">Social</span>
                    <ul class="nav-list">
                        <li class="nav-item" data-view="friends" data-tab="main">
                            <a href="#friends" class="nav-link">
                                <span class="nav-icon">üë•</span>
                                <span class="nav-text">Friends</span>
                                <span class="nav-count" id="friendsCount">0</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="activity" data-tab="main">
                            <a href="#activity" class="nav-link">
                                <span class="nav-icon">üìä</span>
                                <span class="nav-text">Activity</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <span class="nav-section-title">Analytics</span>
                    <ul class="nav-list">
                        <li class="nav-item" data-view="stats" data-tab="main">
                            <a href="#stats" class="nav-link">
                                <span class="nav-icon">üìà</span>
                                <span class="nav-text">Statistics</span>
                            </a>
                        </li>
                        <li class="nav-item" data-view="insights" data-tab="main">
                            <a href="#insights" class="nav-link">
                                <span class="nav-icon">üí°</span>
                                <span class="nav-text">Insights</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Playlists Section -->
            <div class="playlists-section">
                <div class="playlists-header">
                    <span class="playlists-title">My Playlists</span>
                    <button class="btn-create-playlist" onclick="app.playlists.create()" title="Create new playlist">
                        <span>+</span>
                    </button>
                </div>
                <div class="playlists-list" id="playlistsList">
                    <div class="playlists-empty">No playlists yet</div>
                </div>
            </div>

            <!-- Sync Status Panel -->
            <div class="sync-panel" id="syncPanel">
                <div class="sync-header">
                    <div class="sync-icon-container">
                        <span class="sync-icon" id="syncIcon">‚òÅÔ∏è</span>
                        <div class="sync-pulse" id="syncPulse"></div>
                    </div>
                    <div class="sync-info">
                        <span class="sync-title" id="syncTitle">Sync Ready</span>
                        <span class="sync-detail" id="syncDetail">0 peers connected</span>
                    </div>
                </div>
                <div class="sync-actions">
                    <button class="btn-sync-toggle" onclick="app.p2p.toggle()" id="syncToggle">
                        Start Sync
                    </button>
                    <button class="btn-sync-settings" onclick="app.p2p.settings()">‚öôÔ∏è</button>
                </div>
            </div>

            <!-- Storage Indicator -->
            <div class="storage-panel" id="storagePanel">
                <div class="storage-header">
                    <span class="storage-icon">üíæ</span>
                    <span class="storage-text">Storage</span>
                    <span class="storage-percent" id="storagePercent">0%</span>
                </div>
                <div class="storage-bar">
                    <div class="storage-used" id="storageUsed"></div>
                </div>
                <div class="storage-details">
                    <span id="storageUsedText">0 MB</span>
                    <span>/</span>
                    <span id="storageTotalText">5 GB</span>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <button class="footer-btn" onclick="app.voice.toggle()" id="voiceBtn" title="Voice Control">
                    <span class="footer-icon">üé§</span>
                    <span class="footer-text">Voice</span>
                </button>
                <button class="footer-btn" onclick="app.settings.open()" title="Settings">
                    <span class="footer-icon">‚öôÔ∏è</span>
                    <span class="footer-text">Settings</span>
                </button>
                <button class="footer-btn" onclick="app.help.open()" title="Help">
                    <span class="footer-icon">‚ùì</span>
                    <span class="footer-text">Help</span>
                </button>
            </div>
        </aside>

        <!-- ==================== MAIN CONTENT ==================== -->
        <main id="mainContent" class="main-content" role="main">
            
            <!-- Top Bar -->
            <header class="top-bar" id="topBar">
                <div class="top-bar-left">
                    <button class="btn-menu" onclick="app.ui.toggleSidebar()" aria-label="Toggle menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    
                    <nav class="breadcrumbs" id="breadcrumbs">
                        <span class="breadcrumb-item">Home</span>
                    </nav>
                </div>

                <div class="top-bar-center">
                    <div class="search-wrapper" id="searchWrapper">
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input 
                                type="text" 
                                id="searchInput" 
                                placeholder="Search songs, artists, albums, lyrics..." 
                                autocomplete="off"
                                aria-label="Search"
                            >
                            <button class="btn-voice-search" onclick="app.voice.search()" title="Voice search">
                                üéôÔ∏è
                            </button>
                            <button class="btn-clear-search hidden" onclick="app.search.clear()" id="clearSearch">√ó</button>
                        </div>
                        
                        <div class="search-dropdown hidden" id="searchDropdown">
                            <div class="search-categories">
                                <button class="search-cat active" data-cat="all">All</button>
                                <button class="search-cat" data-cat="songs">Songs</button>
                                <button class="search-cat" data-cat="artists">Artists</button>
                                <button class="search-cat" data-cat="albums">Albums</button>
                                <button class="search-cat" data-cat="lyrics">Lyrics</button>
                            </div>
                            <div class="search-results" id="searchResults"></div>
                            <div class="search-history" id="searchHistory">
                                <div class="history-header">
                                    <span>Recent Searches</span>
                                    <button onclick="app.search.clearHistory()">Clear</button>
                                </div>
                                <div class="history-list" id="historyList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="top-bar-right">
                    <!-- Broadcast Button -->
                    <button class="top-btn broadcast-btn" onclick="app.broadcast.toggle()" id="broadcastBtn" title="Start broadcast">
                        <span class="btn-icon">üì°</span>
                        <span class="btn-text">Broadcast</span>
                        <span class="broadcast-indicator hidden" id="broadcastIndicator">LIVE</span>
                    </button>

                    <!-- Audio Effects -->
                    <button class="top-btn" onclick="app.effects.toggle()" title="Audio effects">
                        <span class="btn-icon">üéöÔ∏è</span>
                    </button>

                    <!-- Theme Toggle -->
                    <button class="top-btn" onclick="app.themes.toggle()" title="Change theme">
                        <span class="btn-icon" id="themeIcon">üåô</span>
                    </button>

                    <!-- Notifications -->
                    <div class="notifications-wrapper">
                        <button class="top-btn" onclick="app.notifications.toggle()" title="Notifications">
                            <span class="btn-icon">üîî</span>
                            <span class="notification-badge hidden" id="notifBadge">0</span>
                        </button>
                        <div class="notifications-panel hidden" id="notificationsPanel">
                            <div class="notifications-header">
                                <h4>Notifications</h4>
                                <button onclick="app.notifications.markAllRead()">Mark all read</button>
                            </div>
                            <div class="notifications-list" id="notificationsList"></div>
                        </div>
                    </div>

                    <!-- Fullscreen -->
                    <button class="top-btn" onclick="app.ui.toggleFullscreen()" title="Fullscreen">
                        <span class="btn-icon">‚õ∂</span>
                    </button>

                    <!-- Developer Mode -->
                    <button class="top-btn dev-btn" onclick="app.dev.toggle()" title="Developer mode" id="devBtn">
                        <span class="btn-icon">üîß</span>
                    </button>
                </div>
            </header>

            <!-- Content Views -->
            <div class="content-views" id="contentViews">
                
                <!-- ==================== HOME VIEW ==================== -->
                <section id="homeView" class="view active" data-view="home">
                    
                    <!-- Hero Section -->
                    <div class="hero-section" id="heroSection">
                        <div class="hero-content">
                            <div class="hero-greeting">
                                <h2 id="heroGreeting">Good evening,</h2>
                                <h1 id="heroName">Music Lover</h1>
                            </div>
                            <p class="hero-subtitle">Ready to discover something amazing?</p>
                            
                            <div class="hero-stats">
                                <div class="hero-stat">
                                    <span class="stat-number" id="statSongs">0</span>
                                    <span class="stat-label">Songs</span>
                                </div>
                                <div class="hero-stat">
                                    <span class="stat-number" id="statHours">0</span>
                                    <span class="stat-label">Hours</span>
                                </div>
                                <div class="hero-stat">
                                    <span class="stat-number" id="statStreak">0</span>
                                    <span class="stat-label">Day Streak üî•</span>
                                </div>
                            </div>

                            <div class="hero-actions">
                                <button class="btn-hero-primary" onclick="app.player.playRandom()">
                                    <span>‚ñ∂</span>
                                    <span>Shuffle Play</span>
                                </button>
                                <button class="btn-hero-secondary" onclick="app.ai.generatePlaylist()">
                                    <span>‚ú®</span>
                                    <span>AI Playlist</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hero-visual">
                            <canvas id="heroVisualizer" class="hero-canvas"></canvas>
                            <div class="hero-blob blob-1"></div>
                            <div class="hero-blob blob-2"></div>
                        </div>
                    </div>

                    <!-- Quick Access -->
                    <div class="quick-access">
                        <h3 class="section-title">Quick Access</h3>
                        <div class="quick-grid">
                            <button class="quick-item" onclick="app.player.resumeLast()">
                                <span class="quick-icon">‚ñ∂Ô∏è</span>
                                <span class="quick-text">Continue Listening</span>
                            </button>
                            <button class="quick-item" onclick="app.view.show('favorites')">
                                <span class="quick-icon">‚ù§Ô∏è</span>
                                <span class="quick-text">Favorites</span>
                            </button>
                            <button class="quick-item" onclick="app.view.show('offline')">
                                <span class="quick-icon">üì≤</span>
                                <span class="quick-text">Offline</span>
                            </button>
                            <button class="quick-item" onclick="app.view.show('history')">
                                <span class="quick-icon">üïê</span>
                                <span class="quick-text">History</span>
                            </button>
                        </div>
                    </div>

                    <!-- Made For You -->
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">üéØ Made For You</h3>
                            <div class="section-actions">
                                <button onclick="app.ai.refreshRecommendations()">üîÑ Refresh</button>
                                <button onclick="app.view.show('discover')">See All</button>
                            </div>
                        </div>
                        <div class="recommendation-grid" id="recommendationGrid"></div>
                    </div>

                    <!-- Mood Stations -->
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">üé≠ Mood Stations</h3>
                            <button onclick="app.mood.showAll()">Browse All</button>
                        </div>
                        <div class="mood-grid" id="moodGrid">
                            <div class="mood-card mood-happy" onclick="app.mood.play('happy')" data-mood="happy">
                                <div class="mood-icon">üòä</div>
                                <div class="mood-info">
                                    <span class="mood-name">Happy</span>
                                    <span class="mood-count">124 songs</span>
                                </div>
                                <div class="mood-gradient"></div>
                            </div>
                            <div class="mood-card mood-chill" onclick="app.mood.play('chill')" data-mood="chill">
                                <div class="mood-icon">üòå</div>
                                <div class="mood-info">
                                    <span class="mood-name">Chill</span>
                                    <span class="mood-count">89 songs</span>
                                </div>
                                <div class="mood-gradient"></div>
                            </div>
                            <div class="mood-card mood-focus" onclick="app.mood.play('focus')" data-mood="focus">
                                <div class="mood-icon">üéØ</div>
                                <div class="mood-info">
                                    <span class="mood-name">Focus</span>
                                    <span class="mood-count">156 songs</span>
                                </div>
                                <div class="mood-gradient"></div>
                            </div>
                            <div class="mood-card mood-workout" onclick="app.mood.play('workout')" data-mood="workout">
                                <div class="mood-icon">üí™</div>
                                <div class="mood-info">
                                    <span class="mood-name">Workout</span>
                                    <span class="mood-count">78 songs</span>
                                </div>
                                <div class="mood-gradient"></div>
                            </div>
                            <div class="mood-card mood-sad" onclick="app.mood.play('sad')" data-mood="sad">
                                <div class="mood-icon">üò¢</div>
                                <div class="mood-info">
                                    <span class="mood-name">Melancholy</span>
                                    <span class="mood-count">67 songs</span>
                                </div>
                                <div class="mood-gradient"></div>
                            </div>
                            <div class="mood-card mood-party" onclick="app.mood.play('party')" data-mood="party">
                                <div class="mood-icon">üéâ</div>
                                <div class="mood-info">
                                    <span class="mood-name">Party</span>
                                    <span class="mood-count">203 songs</span>
                                </div>
                                <div class="mood-gradient"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Recently Played -->
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">üïê Recently Played</h3>
                            <button onclick="app.view.show('history')">View History</button>
                        </div>
                        <div class="recent-grid" id="recentGrid"></div>
                    </div>

                    <!-- Trending -->
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">üìà Trending Now</h3>
                            <button onclick="app.trending.showMore()">More</button>
                        </div>
                        <div class="trending-list" id="trendingList"></div>
                    </div>

                    <!-- New Releases -->
                    <div class="content-section">
                        <div class="section-header">
                            <h3 class="section-title">üÜï New Releases</h3>
                        </div>
                        <div class="releases-grid" id="releasesGrid"></div>
                    </div>
                </section>

                <!-- ==================== LIBRARY VIEW ==================== -->
                <section id="libraryView" class="view" data-view="library">
                    <div class="library-header">
                        <h2 class="view-title">Your Library</h2>
                        <div class="library-actions">
                            <button class="btn-import" onclick="app.library.import()">
                                <span>üì•</span>
                                <span>Import</span>
                            </button>
                            <button class="btn-scan" onclick="app.library.scan()">
                                <span>üîç</span>
                                <span>Scan</span>
                            </button>
                        </div>
                    </div>

                    <div class="library-tabs">
                        <button class="lib-tab active" data-tab="songs">Songs</button>
                        <button class="lib-tab" data-tab="albums">Albums</button>
                        <button class="lib-tab" data-tab="artists">Artists</button>
                        <button class="lib-tab" data-tab="genres">Genres</button>
                    </div>

                    <div class="library-toolbar">
                        <div class="filter-chips">
                            <button class="chip active" data-filter="all">All</button>
                            <button class="chip" data-filter="favorites">‚ù§Ô∏è Favorites</button>
                            <button class="chip" data-filter="downloaded">‚¨áÔ∏è Downloaded</button>
                            <button class="chip" data-filter="recent">üïê Recent</button>
                            <button class="chip" data-filter="most-played">üî• Most Played</button>
                            <button class="chip" data-filter="never-played">üì¶ Never Played</button>
                        </div>
                        
                        <div class="library-controls">
                            <div class="sort-control">
                                <label>Sort by:</label>
                                <select id="sortSelect" onchange="app.library.sort(this.value)">
                                    <option value="recent">Recently Added</option>
                                    <option value="title">Title A-Z</option>
                                    <option value="artist">Artist A-Z</option>
                                    <option value="album">Album A-Z</option>
                                    <option value="duration">Duration</option>
                                    <option value="plays">Play Count</option>
                                    <option value="rating">Rating</option>
                                </select>
                            </div>
                            
                            <div class="view-toggle">
                                <button class="view-btn active" data-view="grid" onclick="app.library.setView('grid')">
                                    ‚äû Grid
                                </button>
                                <button class="view-btn" data-view="list" onclick="app.library.setView('list')">
                                    ‚ò∞ List
                                </button>
                                <button class="view-btn" data-view="compact" onclick="app.library.setView('compact')">
                                    ‚â° Compact
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="library-content" id="libraryContent">
                        <div class="skeleton-grid">
                            <div class="skeleton-card"></div>
                            <div class="skeleton-card"></div>
                            <div class="skeleton-card"></div>
                            <div class="skeleton-card"></div>
                            <div class="skeleton-card"></div>
                            <div class="skeleton-card"></div>
                        </div>
                    </div>

                    <div class="library-footer">
                        <span id="libraryStats">Loading...</span>
                    </div>
                </section>

                <!-- ==================== DISCOVER VIEW ==================== -->
                <section id="discoverView" class="view" data-view="discover">
                    <div class="discover-hero">
                        <div class="ai-mascot">ü§ñ</div>
                        <h2>AI Music Discovery</h2>
                        <p>Let artificial intelligence find your next favorite song</p>
                    </div>

                    <div class="ai-tools-grid">
                        <div class="ai-tool-card" onclick="app.ai.findSimilar()">
                            <div class="ai-tool-icon">üéµ</div>
                            <h4>Find Similar</h4>
                            <p>Discover songs like your favorites based on audio analysis</p>
                            <div class="ai-tool-badge">Popular</div>
                        </div>
                        
                        <div class="ai-tool-card" onclick="app.ai.generateLyrics()">
                            <div class="ai-tool-icon">üìù</div>
                            <h4>Generate Lyrics</h4>
                            <p>Create synchronized lyrics from any audio file</p>
                            <div class="ai-tool-badge new">NEW</div>
                        </div>
                        
                        <div class="ai-tool-card" onclick="app.ai.analyzeMood()">
                            <div class="ai-tool-icon">üé≠</div>
                            <h4>Mood Analysis</h4>
                            <p>Deep emotional analysis of your music</p>
                        </div>
                        
                        <div class="ai-tool-card" onclick="app.ai.smartShuffle()">
                            <div class="ai-tool-icon">üé≤</div>
                            <h4>Smart Shuffle</h4>
                            <p>AI-optimized queue based on your listening patterns</p>
                        </div>
                        
                        <div class="ai-tool-card" onclick="app.ai.createMix()">
                            <div class="ai-tool-icon">üéß</div>
                            <h4>AI DJ Mix</h4>
                            <p>Seamless transitions between songs</p>
                        </div>
                        
                        <div class="ai-tool-card" onclick="app.ai.weeklyDiscovery()">
                            <div class="ai-tool-icon">üìÖ</div>
                            <h4>Weekly Discovery</h4>
                            <p>Personalized playlist every Monday</p>
                        </div>
                    </div>

                    <div class="discover-results" id="discoverResults"></div>
                </section>

                <!-- ==================== LIVE VIEW ==================== -->
                <section id="liveView" class="view" data-view="live">
                    <div class="live-hero">
                        <div class="live-status-indicator" id="liveStatusIndicator">
                            <span class="status-dot"></span>
                            <span class="status-text">OFFLINE</span>
                        </div>
                        <h2>Live Broadcast</h2>
                        <p>Stream your music to the world or join others in real-time</p>
                    </div>

                    <div class="live-actions">
                        <button class="btn-live-start" onclick="app.live.startBroadcast()">
                            <span class="live-icon">üî¥</span>
                            <div class="live-btn-content">
                                <span class="live-btn-title">Start Broadcasting</span>
                                <span class="live-btn-desc">Share your music with others</span>
                            </div>
                        </button>
                        
                        <button class="btn-live-join" onclick="app.live.joinBroadcast()">
                            <span class="live-icon">üë•</span>
                            <div class="live-btn-content">
                                <span class="live-btn-title">Join Broadcast</span>
                                <span class="live-btn-desc">Listen with friends</span>
                            </div>
                        </button>
                    </div>

                    <div class="live-section">
                        <h3>Active Broadcasts</h3>
                        <div class="live-rooms" id="liveRooms">
                            <div class="live-empty">
                                <span>üì°</span>
                                <p>No active broadcasts nearby</p>
                                <small>Start your own or check back later</small>
                            </div>
                        </div>
                    </div>

                    <div class="live-section">
                        <h3>Your Broadcast History</h3>
                        <div class="live-history" id="liveHistory"></div>
                    </div>
                </section>

                <!-- ==================== STATS VIEW ==================== -->
                <section id="statsView" class="view" data-view="stats">
                    <div class="stats-header">
                        <h2>Your Music Statistics</h2>
                        <div class="stats-period">
                            <button class="period-btn active" data-period="week">Week</button>
                            <button class="period-btn" data-period="month">Month</button>
                            <button class="period-btn" data-period="year">Year</button>
                            <button class="period-btn" data-period="all">All Time</button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card highlight">
                            <div class="stat-icon">üéµ</div>
                            <div class="stat-value" id="totalPlays">0</div>
                            <div class="stat-label">Total Plays</div>
                        </div>
                        
                        <div class="stat-card highlight">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-value" id="totalTime">0h</div>
                            <div class="stat-label">Listening Time</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üé≠</div>
                            <div class="stat-value" id="topGenre">-</div>
                            <div class="stat-label">Top Genre</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üìÖ</div>
                            <div class="stat-value" id="activeDay">-</div>
                            <div class="stat-label">Most Active Day</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">‚è∞</div>
                            <div class="stat-value" id="peakHour">-</div>
                            <div class="stat-label">Peak Listening Hour</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üî•</div>
                            <div class="stat-value" id="currentStreak">0</div>
                            <div class="stat-label">Day Streak</div>
                        </div>
                    </div>

                    <div class="stats-charts">
                        <div class="chart-container">
                            <h4>Listening Activity</h4>
                            <canvas id="activityChart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h4>Genre Distribution</h4>
                            <canvas id="genreChart"></canvas>
                        </div>
                    </div>

                    <div class="stats-lists">
                        <div class="stats-list-container">
                            <h4>Top Artists</h4>
                            <div class="top-list" id="topArtists"></div>
                        </div>
                        
                        <div class="stats-list-container">
                            <h4>Top Songs</h4>
                            <div class="top-list" id="topSongs"></div>
                        </div>
                    </div>
                </section>

                <!-- Additional Views: playlists, favorites, history, offline, friends, activity, insights -->
                <!-- Implemented with same level of detail -->

            </div>
        </main>

        <!-- ==================== PLAYER BAR ==================== -->
        <div id="playerBar" class="player-bar">
            
            <!-- Track Info -->
            <div class="player-section track-section">
                <div class="track-container">
                    <div class="track-artwork" id="trackArtwork">
                        <img src="assets/images/default-cover.png" alt="Album Art" id="playerCover">
                        <div class="track-artwork-overlay">
                            <button onclick="app.player.expand()" class="btn-expand-artwork">‚õ∂</button>
                        </div>
                    </div>
                    
                    <div class="track-info">
                        <div class="track-title" id="playerTitle">Select a song</div>
                        <div class="track-artist" id="playerArtist">-</div>
                    </div>
                    
                    <div class="track-actions">
                        <button class="btn-track-action" onclick="app.player.toggleLike()" id="likeBtn" title="Like">ü§ç</button>
                        <button class="btn-track-action" onclick="app.offline.downloadCurrent()" id="downloadBtn" title="Download">‚¨áÔ∏è</button>
                        <button class="btn-track-action" onclick="app.player.addToPlaylist()" title="Add to playlist">üìë</button>
                        <button class="btn-track-action" onclick="app.player.share()" title="Share">‚ÜóÔ∏è</button>
                    </div>
                </div>
            </div>

            <!-- Player Controls -->
            <div class="player-section controls-section">
                <div class="controls-row">
                    <button class="control-btn" onclick="app.player.toggleShuffle()" id="shuffleBtn" title="Shuffle">üîÄ</button>
                    <button class="control-btn" onclick="app.player.prev()" title="Previous">‚èÆ</button>
                    <button class="control-btn play-btn" onclick="app.player.toggle()" id="playBtn" title="Play/Pause">
                        <span class="play-icon">‚ñ∂</span>
                    </button>
                    <button class="control-btn" onclick="app.player.next()" title="Next">‚è≠</button>
                    <button class="control-btn" onclick="app.player.toggleRepeat()" id="repeatBtn" title="Repeat">üîÅ</button>
                </div>

                <div class="progress-row">
                    <span class="time-current" id="currentTime">0:00</span>
                    
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                            <div class="progress-handle"></div>
                        </div>
                        <div class="waveform-container" id="waveformContainer"></div>
                    </div>
                    
                    <span class="time-total" id="totalTime">0:00</span>
                </div>
            </div>

            <!-- Extra Controls -->
            <div class="player-section extras-section">
                <button class="extra-btn" onclick="app.queue.toggle()" title="Queue">
                    <span>‚ò∞</span>
                    <span class="queue-count hidden" id="queueCount">0</span>
                </button>
                
                <button class="extra-btn" onclick="app.lyrics.toggle()" title="Lyrics">üé§</button>
                <button class="extra-btn" onclick="app.player.toggleSleep()" title="Sleep timer">‚è±Ô∏è</button>
                
                <div class="volume-control">
                    <button class="btn-volume" onclick="app.player.toggleMute()" id="muteBtn">üîä</button>
                    <div class="volume-slider-container">
                        <input type="range" min="0" max="100" value="80" id="volumeSlider" class="volume-slider">
                    </div>
                </div>

                <button class="extra-btn btn-expand-player" onclick="app.player.expand()" title="Expand">‚õ∂</button>
            </div>
        </div>

        <!-- ==================== EXPANDED PLAYER ==================== -->
        <div id="expandedPlayer" class="expanded-player">
            <div class="expanded-backdrop" id="expandedBackdrop"></div>
            
            <div class="expanded-header">
                <button class="btn-collapse" onclick="app.player.collapse()">
                    <span>‚Üì</span>
                </button>
                
                <div class="expanded-tabs">
                    <button class="exp-tab active" data-tab="now">Now Playing</button>
                    <button class="exp-tab" data-tab="lyrics">Lyrics</button>
                    <button class="exp-tab" data-tab="queue">Queue</button>
                    <button class="exp-tab" data-tab="related">Related</button>
                </div>
                
                <div class="expanded-actions">
                    <button onclick="app.player.share()">Share</button>
                    <button onclick="app.ai.analyzeCurrent()">Analyze</button>
                    <button onclick="app.player.addToPlaylist()">+ Playlist</button>
                </div>
            </div>

            <div class="expanded-content">
                <!-- Vinyl Stage -->
                <div class="vinyl-stage">
                    <div class="vinyl-container" id="vinylContainer">
                        <div class="vinyl">
                            <img src="" alt="" id="expandedCover">
                            <div class="vinyl-center"></div>
                        </div>
                        <div class="vinyl-arm"></div>
                    </div>
                    
                    <div class="now-playing-visualizer">
                        <canvas id="expandedVisualizer"></canvas>
                    </div>
                </div>

                <!-- Track Info Large -->
                <div class="expanded-info">
                    <h1 class="expanded-title" id="expandedTitle">Title</h1>
                    <p class="expanded-artist" id="expandedArtist">Artist</p>
                    <p class="expanded-album" id="expandedAlbum">Album</p>
                    
                    <div class="expanded-controls">
                        <button class="exp-control" onclick="app.player.prev()">‚èÆ</button>
                        <button class="exp-control play" onclick="app.player.toggle()">‚ñ∂</button>
                        <button class="exp-control" onclick="app.player.next()">‚è≠</button>
                    </div>
                    
                    <div class="expanded-progress">
                        <input type="range" min="0" max="100" value="0" id="expandedProgress">
                    </div>
                </div>

                <!-- Side Panel -->
                <div class="expanded-sidebar">
                    <div class="sidebar-section">
                        <h4>Up Next</h4>
                        <div class="up-next-list" id="expandedQueue"></div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h4>Song Details</h4>
                        <div class="song-details">
                            <div class="detail-row">
                                <span>Duration</span>
                                <span id="detailDuration">-</span>
                            </div>
                            <div class="detail-row">
                                <span>Quality</span>
                                <span id="detailQuality">320 kbps</span>
                            </div>
                            <div class="detail-row">
                                <span>Format</span>
                                <span id="detailFormat">MP3</span>
                            </div>
                            <div class="detail-row">
                                <span>Plays</span>
                                <span id="detailPlays">0</span>
                            </div>
                            <div class="detail-row">
                                <span>Added</span>
                                <span id="detailAdded">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== LYRICS PANEL ==================== -->
        <div id="lyricsPanel" class="lyrics-panel">
            <div class="lyrics-header">
                <h3>üé§ Lyrics</h3>
                <div class="lyrics-tools">
                    <div class="lyrics-time-adjust">
                        <button onclick="app.lyrics.adjustTime(-0.5)" title="-0.5s">-</button>
                        <span id="lyricsOffset">0s</span>
                        <button onclick="app.lyrics.adjustTime(0.5)" title="+0.5s">+</button>
                    </div>
                    <button onclick="app.lyrics.toggleKaraoke()" title="Karaoke mode">üé§</button>
                    <button onclick="app.lyrics.toggleTranslation()" title="Translate">üåê</button>
                    <button onclick="app.lyrics.toggleFullscreen()" title="Fullscreen">‚õ∂</button>
                    <button onclick="app.lyrics.toggle()" class="btn-close">√ó</button>
                </div>
            </div>
            
            <div class="lyrics-content" id="lyricsContent">
                <div class="lyrics-placeholder">
                    <span>üéµ</span>
                    <p>Select a song to view lyrics</p>
                </div>
            </div>
            
            <div class="lyrics-footer">
                <button onclick="app.ai.generateLyrics()" class="btn-ai-lyrics">
                    ‚ú® Generate AI Lyrics
                </button>
            </div>
        </div>

        <!-- ==================== QUEUE PANEL ==================== -->
        <div id="queuePanel" class="queue-panel">
            <div class="queue-header">
                <h3>Queue</h3>
                <div class="queue-actions">
                    <button onclick="app.queue.clear()">Clear</button>
                    <button onclick="app.queue.saveAsPlaylist()">Save as Playlist</button>
                    <button onclick="app.queue.toggle()" class="btn-close">√ó</button>
                </div>
            </div>
            
            <div class="queue-content" id="queueContent">
                <div class="queue-empty">
                    <span>üì≠</span>
                    <p>Queue is empty</p>
                </div>
            </div>
        </div>

        <!-- ==================== EFFECTS PANEL ==================== -->
        <div id="effectsPanel" class="effects-panel">
            <div class="effects-header">
                <h3>üéöÔ∏è Audio Effects</h3>
                <button onclick="app.effects.toggle()" class="btn-close">√ó</button>
            </div>

            <div class="effects-content">
                <!-- Equalizer -->
                <div class="effect-section">
                    <h4>Equalizer</h4>
                    <div class="eq-container">
                        <div class="eq-band" data-freq="60">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>60Hz</label>
                        </div>
                        <div class="eq-band" data-freq="170">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>170Hz</label>
                        </div>
                        <div class="eq-band" data-freq="310">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>310Hz</label>
                        </div>
                        <div class="eq-band" data-freq="600">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>600Hz</label>
                        </div>
                        <div class="eq-band" data-freq="1000">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>1kHz</label>
                        </div>
                        <div class="eq-band" data-freq="3000">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>3kHz</label>
                        </div>
                        <div class="eq-band" data-freq="6000">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>6kHz</label>
                        </div>
                        <div class="eq-band" data-freq="12000">
                            <input type="range" min="-12" max="12" value="0" orient="vertical">
                            <label>12kHz</label>
                        </div>
                    </div>
                    <div class="eq-presets">
                        <button onclick="app.effects.loadPreset('flat')">Flat</button>
                        <button onclick="app.effects.loadPreset('bass')">Bass Boost</button>
                        <button onclick="app.effects.loadPreset('vocal')">Vocal</button>
                        <button onclick="app.effects.loadPreset('treble')">Treble</button>
                    </div>
                </div>

                <!-- Spatial Audio -->
                <div class="effect-section">
                    <h4>3D Spatial Audio</h4>
                    <div class="spatial-control">
                        <label>Intensity</label>
                        <input type="range" min="0" max="100" value="0" id="spatialSlider">
                    </div>
                </div>

                <!-- Reverb -->
                <div class="effect-section">
                    <h4>Reverb</h4>
                    <select id="reverbSelect">
                        <option value="none">None</option>
                        <option value="room">Small Room</option>
                        <option value="hall">Concert Hall</option>
                        <option value="cathedral">Cathedral</option>
                        <option value="plate">Plate</option>
                    </select>
                </div>

                <!-- Playback Speed -->
                <div class="effect-section">
                    <h4>Playback Speed</h4>
                    <div class="speed-control">
                        <input type="range" min="50" max="150" value="100" id="speedSlider">
                        <span id="speedValue">1.0x</span>
                    </div>
                </div>

                <!-- Pitch Shift -->
                <div class="effect-section">
                    <h4>Pitch Shift</h4>
                    <div class="pitch-control">
                        <button onclick="app.effects.pitch(-1)">-1</button>
                        <span id="pitchValue">0</span>
                        <button onclick="app.effects.pitch(1)">+1</button>
                    </div>
                </div>

                <button onclick="app.effects.resetAll()" class="btn-reset-effects">Reset All Effects</button>
            </div>
        </div>

        <!-- ==================== SETTINGS MODAL ==================== -->
        <div id="settingsModal" class="modal">
            <div class="modal-content settings-modal">
                <div class="modal-header">
                    <h2>‚öôÔ∏è Settings</h2>
                    <button onclick="app.settings.close()" class="btn-close">√ó</button>
                </div>

                <div class="settings-layout">
                    <div class="settings-sidebar">
                        <button class="settings-tab active" data-tab="general">General</button>
                        <button class="settings-tab" data-tab="audio">Audio</button>
                        <button class="settings-tab" data-tab="playback">Playback</button>
                        <button class="settings-tab" data-tab="lyrics">Lyrics</button>
                        <button class="settings-tab" data-tab="sync">Sync & P2P</button>
                        <button class="settings-tab" data-tab="ai">AI Features</button>
                        <button class="settings-tab" data-tab="offline">Offline</button>
                        <button class="settings-tab" data-tab="privacy">Privacy</button>
                        <button class="settings-tab" data-tab="advanced">Advanced</button>
                    </div>

                    <div class="settings-content" id="settingsContent">
                        <!-- Settings panels loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== DEVELOPER PANEL ==================== -->
        <div id="devPanel" class="dev-panel">
            <div class="dev-header">
                <h3>üîß Developer Console v1.3</h3>
                <div class="dev-header-actions">
                    <button onclick="app.dev.toggleLog()">üìã Logs</button>
                    <button onclick="app.dev.inspect()">üîç Inspect</button>
                    <button onclick="app.dev.benchmark()">‚è±Ô∏è Benchmark</button>
                    <button onclick="app.dev.toggle()">√ó</button>
                </div>
            </div>

            <div class="dev-tabs">
                <button class="dev-tab active" data-tab="songs">Songs</button>
                <button class="dev-tab" data-tab="database">Database</button>
                <button class="dev-tab" data-tab="ai">AI Lab</button>
                <button class="dev-tab" data-tab="p2p">P2P Network</button>
                <button class="dev-tab" data-tab="performance">Performance</button>
                <button class="dev-tab" data-tab="console">Console</button>
                <button class="dev-tab" data-tab="system">System</button>
            </div>

            <div class="dev-content" id="devContent">
                <!-- Content loaded dynamically -->
            </div>
        </div>

        <!-- ==================== VOICE OVERLAY ==================== -->
        <div id="voiceOverlay" class="voice-overlay">
            <div class="voice-container">
                <div class="voice-waves">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <p class="voice-text" id="voiceText">Listening...</p>
                <p class="voice-hint">Say "play", "pause", "next", or song name</p>
            </div>
        </div>

        <!-- ==================== TOAST CONTAINER ==================== -->
        <div id="toastContainer" class="toast-container"></div>

        <!-- ==================== CONTEXT MENU ==================== -->
        <div id="contextMenu" class="context-menu"></div>

        <!-- ==================== TOOLTIP ==================== -->
        <div id="tooltip" class="tooltip"></div>

    </div><!-- /#app -->

    <!-- ==================== SCRIPTS ==================== -->
    
    <!-- Core Utilities -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    
    <!-- Main Modules -->
    <script src="js/core.js"></script>
    <script src="js/player.js"></script>
    <script src="js/lyrics.js"></script>
    <script src="js/playlist.js"></script>
    <script src="js/visualizer.js"></script>
    <script src="js/library.js"></script>
    <script src="js/themes.js"></script>
    <script src="js/dev.js"></script>
    
    <!-- AI Modules -->
    <script src="js/ai/lyrics-generator.js"></script>
    <script src="js/ai/mood-analyzer.js"></script>
    <script src="js/ai/recommender.js"></script>
    <script src="js/ai/smart-shuffle.js"></script>
    
    <!-- P2P Modules -->
    <script src="js/p2p/sync-manager.js"></script>
    <script src="js/p2p/webrtc-broadcast.js"></script>
    <script src="js/p2p/signaling.js"></script>
    <script src="js/p2p/data-channel.js"></script>
    
    <!-- Offline Modules -->
    <script src="js/offline/cache-manager.js"></script>
    <script src="js/offline/storage-manager.js"></script>
    <script src="js/offline/sync-engine.js"></script>
    
    <!-- Voice Modules -->
    <script src="js/voice/voice-controller.js"></script>
    <script src="js/voice/command-parser.js"></script>
    <script src="js/voice/natural-language.js"></script>
    
    <!-- Analytics Modules -->
    <script src="js/analytics/stats-tracker.js"></script>
    <script src="js/analytics/report-generator.js"></script>
    <script src="js/analytics/insights-engine.js"></script>
    
    <!-- Effects Modules -->
    <script src="js/effects/equalizer.js"></script>
    <script src="js/effects/spatial-audio.js"></script>
    <script src="js/effects/audio-filters.js"></script>
    
    <!-- Plugin System -->
    <script src="js/plugins/plugin-manager.js"></script>
    <script src="js/plugins/plugin-api.js"></script>
    <script src="js/plugins/sandbox.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered:', registration);
                    })
                    .catch(error => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>

    <!-- App Initialization -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize loading sequence
            app.loading.start();
            
            // Load modules sequentially
            const modules = [
                'utils', 'api', 'ui', 'core', 'player', 'lyrics', 
                'playlist', 'visualizer', 'library', 'themes', 'dev',
                'ai', 'p2p', 'offline', 'voice', 'analytics', 'effects', 'plugins'
            ];
            
            let loaded = 0;
            const total = modules.length;
            
            const loadModule = (name) => {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        loaded++;
                        const percent = Math.round((loaded / total) * 100);
                        app.loading.update(percent, `Loading ${name}...`);
                        resolve();
                    }, 100);
                });
            };
            
            (async () => {
                for (const mod of modules) {
                    await loadModule(mod);
                }
                
                // Initialize app
                setTimeout(() => {
                    app.init();
                    app.loading.complete();
                }, 500);
            })();
        });
    </script>

</body>
</html>
